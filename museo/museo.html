    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const uploadForm = document.getElementById('uploadForm');
            const museumGalleryGrid = document.getElementById('museumGalleryGrid');
            const noPiecesMessage = document.getElementById('noPiecesMessage');
            const imagePreview = document.getElementById('imagePreview');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');
            const piezaImagenInput = document.getElementById('piezaImagen');

            // Modal elements
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalCaption = document.getElementById('modalCaption');
            const modalCloseButton = document.querySelector('.modal-close-button');

            // Define la URL base de tu API. 
            // AJUSTA ESTA LÍNEA SI TU BACKEND ESTÁ EN UNA IP O PUERTO DIFERENTE.
            // Por ejemplo, si tu servidor Flask corre en 10.0.0.164:5000, usa:
            // const API_BASE_URL = "http://10.0.0.164:5000"; 
            // Para pruebas locales donde el backend corre en el mismo PC, localhost:5000 es común.
            const API_BASE_URL = "http://localhost:5000"; 
            
            // Si tu frontend (HTML) y backend se sirven desde el MISMO dominio y puerto EXACTOS, 
            // y AMBOS son HTTP o AMBOS son HTTPS, podrías dejar API_BASE_URL = ""; y usar rutas relativas.
            // Sin embargo, para desarrollo y pruebas, especificar la URL completa del backend es más claro.

            // Advertencia sobre contenido mixto si la página es HTTPS y la API es HTTP
            if (window.location.protocol === "https:" && API_BASE_URL.startsWith("http://")) {
                console.warn("ADVERTENCIA DE CONTENIDO MIXTO: La página se sirve sobre HTTPS, pero la API_BASE_URL está configurada para HTTP. Es probable que el navegador bloquee las solicitudes.");
                if(noPiecesMessage) {
                    noPiecesMessage.innerHTML = `<strong>Advertencia de Contenido Mixto:</strong> Esta página (HTTPS) está intentando acceder a un backend en <em>${API_BASE_URL}</em> (HTTP). Los navegadores suelen bloquear esto por seguridad. Para solucionarlo, tu backend también debe servirse sobre HTTPS.`;
                    noPiecesMessage.style.display = 'block';
                    noPiecesMessage.style.color = 'orange';
                    noPiecesMessage.style.textAlign = 'left';
                    noPiecesMessage.style.padding = '10px';
                    noPiecesMessage.style.border = '1px solid orange';
                    noPiecesMessage.style.backgroundColor = '#fff3cd';
                }
            }


            async function fetchPieces() {
                try {
                    const url = API_BASE_URL ? `${API_BASE_URL}/api/museo/piezas` : '/api/museo/piezas';
                    console.log(`Intentando obtener piezas desde: ${url}`);
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status} - ${response.statusText}. URL: ${url}`);
                    }
                    const pieces = await response.json();
                    renderGallery(pieces);
                } catch (error) {
                    console.error('Error al cargar piezas del museo:', error);
                    if(noPiecesMessage) {
                        noPiecesMessage.innerHTML = `<strong>Error al cargar las piezas:</strong> ${error.message}. <br>Asegúrate de que el backend esté corriendo en <em>${API_BASE_URL || window.location.origin}</em> y sea accesible. <br>Si esta página está en HTTPS y el backend en HTTP, el navegador bloqueará la solicitud (contenido mixto).`;
                        noPiecesMessage.style.display = 'block';
                         noPiecesMessage.style.color = 'red';
                    }
                    if(museumGalleryGrid) museumGalleryGrid.innerHTML = '';
                }
            }

            if (uploadForm) {
                uploadForm.addEventListener('submit', async function(event) {
                    event.preventDefault();

                    const titulo = document.getElementById('piezaTitulo').value.trim();
                    const descripcion = document.getElementById('piezaDescripcion').value.trim();
                    const autor = document.getElementById('piezaAutor').value.trim() || 'Anónimo';
                    const imagenFile = piezaImagenInput.files[0];

                    if (!titulo || !descripcion || !imagenFile) {
                        alert('Por favor, completa el título, la descripción y selecciona una imagen.');
                        return;
                    }
                    if (imagenFile.size > 2 * 1024 * 1024) { // Límite de 2MB
                        alert('La imagen es demasiado grande. El tamaño máximo es 2MB.');
                        return;
                    }

                    const formData = new FormData();
                    formData.append('piezaTitulo', titulo);
                    formData.append('piezaDescripcion', descripcion);
                    formData.append('piezaAutor', autor);
                    formData.append('piezaImagen', imagenFile);

                    try {
                        const url = API_BASE_URL ? `${API_BASE_URL}/api/museo/piezas` : '/api/museo/piezas';
                        console.log(`Intentando subir pieza a: ${url}`);
                        const response = await fetch(url, {
                            method: 'POST',
                            body: formData 
                        });

                        if (!response.ok) {
                            const errorData = await response.json().catch(() => ({ error: `Error del servidor: ${response.status} ${response.statusText}. URL: ${url}` }));
                            throw new Error(errorData.error || `Error del servidor: ${response.status} ${response.statusText}. URL: ${url}`);
                        }

                        const result = await response.json();
                        alert(result.mensaje || '¡Pieza subida con éxito!');
                        fetchPieces(); 
                        uploadForm.reset();
                        if(imagePreview) imagePreview.src = '#';
                        if(imagePreviewContainer) imagePreviewContainer.style.display = 'none';
                    } catch (error) {
                        console.error('Error al subir la pieza:', error);
                        alert(`Error al subir la pieza: ${error.message}`);
                    }
                });
            }
            
            if (piezaImagenInput) {
                 piezaImagenInput.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            if(imagePreview) imagePreview.src = e.target.result;
                            if(imagePreviewContainer) imagePreviewContainer.style.display = 'block';
                        }
                        reader.readAsDataURL(file);
                    } else {
                        if(imagePreview) imagePreview.src = '#';
                        if(imagePreviewContainer) imagePreviewContainer.style.display = 'none';
                    }
                });
            }


            function renderGallery(piecesToRender) {
                if (!museumGalleryGrid || !noPiecesMessage) return;
                museumGalleryGrid.innerHTML = ''; 
                if (piecesToRender.length === 0) {
                    noPiecesMessage.style.display = 'block';
                    noPiecesMessage.textContent = 'Aún no se han añadido piezas al museo. ¡Sé el primero en contribuir!';
                    return;
                }
                noPiecesMessage.style.display = 'none';

                piecesToRender.forEach(pieza => {
                    const card = document.createElement('div');
                    card.classList.add('card', 'museum-piece-card');
                    
                    const img = document.createElement('img');
                    // Construir URL absoluta para la imagen si API_BASE_URL está definida y la URL de la pieza no es ya absoluta
                    let imageUrl = pieza.imagenUrl;
                    if (API_BASE_URL && !pieza.imagenUrl.startsWith('http') && !pieza.imagenUrl.startsWith('data:')) {
                        imageUrl = `${API_BASE_URL}${pieza.imagenUrl}`;
                    } else if (!API_BASE_URL && !pieza.imagenUrl.startsWith('http') && !pieza.imagenUrl.startsWith('data:') && !pieza.imagenUrl.startsWith('/')) {
                        // Si API_BASE_URL está vacía y la URL de la imagen no es absoluta ni relativa a la raíz, podría ser un problema.
                        // Asumimos que es relativa a la raíz si empieza con /
                        imageUrl = pieza.imagenUrl.startsWith('/') ? pieza.imagenUrl : `/${pieza.imagenUrl}`;
                    }

                    img.src = imageUrl; 
                    img.alt = pieza.altText || `Imagen de ${pieza.titulo}`;
                    img.onerror = function() { 
                        this.onerror=null; 
                        this.src='https://placehold.co/600x400/D2B48C/2c1d12?text=Imagen+no+disponible';
                        this.alt = `Error al cargar imagen para ${pieza.titulo}`;
                    };
                    img.addEventListener('click', () => openModal(img.src, `${pieza.titulo} - por ${pieza.autor}`));

                    const cardContent = document.createElement('div');
                    cardContent.classList.add('card-content');

                    const titleH3 = document.createElement('h3');
                    titleH3.innerHTML = `<i class="fas fa-monument"></i> ${pieza.titulo}`; 

                    const authorP = document.createElement('p');
                    authorP.classList.add('piece-author');
                    authorP.innerHTML = `<strong>Aportado por:</strong> ${pieza.autor}`;
                    
                    const descriptionP = document.createElement('p');
                    descriptionP.classList.add('piece-description');
                    descriptionP.textContent = pieza.descripcion.substring(0, 120) + (pieza.descripcion.length > 120 ? '...' : ''); 

                    cardContent.appendChild(titleH3);
                    cardContent.appendChild(authorP);
                    cardContent.appendChild(descriptionP);
                    
                    card.appendChild(img);
                    card.appendChild(cardContent);
                    museumGalleryGrid.appendChild(card);
                });
            }
            
            function openModal(src, caption) {
                if(modal && modalImage && modalCaption) {
                    modal.style.display = "block";
                    modalImage.src = src;
                    modalCaption.innerHTML = caption;
                }
            }

            if (modalCloseButton) {
                modalCloseButton.onclick = function() {
                    if(modal) modal.style.display = "none";
                }
            }
            
            window.onclick = function(event) {
                if (event.target == modal) {
                    if(modal) modal.style.display = "none";
                }
            }
            
            fetchPieces(); 

            const navToggle = document.querySelector('.nav-toggle');
            const navLinks = document.querySelector('.nav-links');

            if (navToggle && navLinks) { 
                navToggle.addEventListener('click', () => {
                    const isExpanded = navToggle.getAttribute('aria-expanded') === 'true' || false;
                    navToggle.setAttribute('aria-expanded', !isExpanded);
                    navLinks.classList.toggle('active');
                });

                navLinks.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', () => {
                        if (navLinks.classList.contains('active')) {
                            navToggle.setAttribute('aria-expanded', 'false');
                            navLinks.classList.remove('active');
                        }
                    });
                });
            }
        });
    </script>
y
